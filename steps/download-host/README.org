:PROPERTIES:
:ID:       45a81693-cd58-49c0-a895-b3d226fdc1a4
:type:     
:tags:
:archived: f
:modified: [2025-09-13 Sat 20:11]
:END:
#+TITLE: Download Host OS Installation Media
#+DESCRIPTION: README for download-host
#+FILETAGS: :publish:

* Purpose
Download the current stable Debian installation media and verification files from official sources.

* Dependencies
- Prerequisites: PowerShell 5.1+ or Bash
- Requires: Internet connection, ~700-800MB disk space
- Produces: debian-[version]-amd64-netinst.iso, SHA512SUMS, SHA512SUMS.sign

* Quick Run
** Windows (PowerShell)
#+begin_src powershell
./run.ps1
#+end_src

** Linux/Mac (Bash)
#+begin_src bash
./run.sh
#+end_src

Both scripts are open-source; read them before you run.

* Manual Commands
If you prefer to run commands individually:

** Windows
#+begin_src powershell
# Create working directory
New-Item -Path "$HOME\Desktop\sovereignty-stack" -ItemType Directory -Force
Set-Location "$HOME\Desktop\sovereignty-stack"

# Find current ISO filename
$BaseUrl = "https://cdimage.debian.org/debian-cd/current/amd64/iso-cd"
$IsoName = (Invoke-WebRequest -Uri "$BaseUrl/" -UseBasicParsing).Content | 
    Select-String -Pattern 'debian-[0-9.]*-amd64-netinst\.iso' | 
    Select-Object -First 1 | 
    ForEach-Object { $_.Matches[0].Value }

# Download files
Invoke-WebRequest -Uri "$BaseUrl/$IsoName" -OutFile $IsoName
Invoke-WebRequest -Uri "$BaseUrl/SHA512SUMS" -OutFile "SHA512SUMS"
Invoke-WebRequest -Uri "$BaseUrl/SHA512SUMS.sign" -OutFile "SHA512SUMS.sign"

# Generate hash for verification
$hash = (Get-FileHash -Algorithm SHA512 $IsoName).Hash
Write-Host "ISO SHA512: $hash"
#+end_src

** Linux
#+begin_src bash
# Create working directory
mkdir -p ~/sovereignty && cd ~/sovereignty

# Find current ISO filename
BASE_URL="https://cdimage.debian.org/debian-cd/current/amd64/iso-cd"
ISO_NAME=$(curl -s "$BASE_URL/" | grep -oP 'debian-[0-9.]+-amd64-netinst\.iso' | head -1)

# Download files
wget "$BASE_URL/$ISO_NAME"
wget "$BASE_URL/SHA512SUMS"
wget "$BASE_URL/SHA512SUMS.sign"

# Generate hash for verification
sha512sum "$ISO_NAME"
#+end_src

* Verification
Run the verification script to ensure successful download:
#+begin_src bash
./verify.sh
#+end_src

Expected output:
- ✓ debian-[version]-amd64-netinst.iso exists (700-800 MB)
- ✓ SHA512SUMS exists
- ✓ SHA512SUMS.sign exists
- ✓ ISO hash computed successfully

* Outputs
This step produces:
| File                               | Description          | Size       |
|------------------------------------+----------------------+------------|
| debian-[version]-amd64-netinst.iso | Debian installer     | 600-700 MB |
| SHA512SUMS                         | Checksum file        | ~1 KB      |
| SHA512SUMS.sign                    | GPG signature        | ~1 KB      |
| download-host.checkpoint.json      | Step checkpoint file | ~1 KB      |

* Rollback
To remove downloaded files and start over:
#+begin_src bash
./rollback.sh
#+end_src

* Next Steps
→ [[file:../gpg-verify-host/README.org][gpg-verify-host]]: Verify ISO authenticity using GPG signatures
→ [[file:../debian-iso-verify/README.org][debian-iso-verify]]: Verify the ISO authenticity
